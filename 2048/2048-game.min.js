var expectOutput=function(h,d,c){var g=JSON.stringify(d),e=JSON.stringify(c),f=JSON.stringify(h(d)),i=e==f;console.log("fn("+g+") => "+f+(i?" PASSED!":" FAILED! Expecting: "+e))};var expectEqual=curry(function(d,c){var f=JSON.stringify(d),e=JSON.stringify(c),g=e==f;console.log(f+" => "+e+(g?" PASSED!":" FAILED!"))}),expectTrue=expectEqual(true),expectFalse=expectEqual(false);var lazyProtoProp=function(b,a){var c=a||("__"+b.name)||"__"+Math.random().toString(36).slice(2);return function(){return this.hasOwnProperty(c)?this[c]:(this[c]=b.apply(this,arguments))}};var size=4,indexFor=function(a,b){if(a>4||b>4||a<1||b<1){return -1}return(b-1)*size+(a-1)},positionFor=function(a){return{x:(a%size)+1,y:Math.floor(a/size)+1}},withinBounds=function(){},emptyGrid=function(){return[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},directions={UP:"UP",RIGHT:"RIGHT",DOWN:"DOWN",LEFT:"LEFT"},traversals={UP:{a:[1,2,3,4],b:[4,3,2,1],vertical:true,dir:"UP"},RIGHT:{a:[1,2,3,4],b:[1,2,3,4],vertical:false,dir:"RIGHT"},DOWN:{a:[1,2,3,4],b:[1,2,3,4],vertical:true,dir:"DOWN"},LEFT:{a:[1,2,3,4],b:[4,3,2,1],vertical:false,dir:"LEFT"}},cellsToRows=curry(function(d,c){var b=traversals[d],a=b.vertical;return reduce(function(e,f){e.push(reduce(function(h,g){return h.concat(c[indexFor(a?f:g,a?g:f)])},[],b.b));return e},[],b.a)}),rowsToCells=curry(function(a,b){switch(a){case directions.UP:return reverse(flatten(map(function(d,c){return reverse(pluck(c,b))},b)));case directions.DOWN:return flatten(map(function(d,c){return pluck(c,b)},b));case directions.RIGHT:return flatten(b);case directions.LEFT:return flatten(b.map(reverse))}}),transformRow=function(e){var a=[0,0,0,0],c=size,b,d=false;while(c--){b=c;while(e[b]===0){b--}if(b<0){continue}a[c]=e[b];e[b]=0;if(a[c+1]===a[c]&&!d){a[c+1]=2*a[c+1];a[c]=0;c++;d=true}else{d=false}}return a},move=function(a){return compose(rowsToCells(a),map(transformRow),cellsToRows(a))},randomCellValue=function(){return Math.random()<0.9?2:4};function Game(a){this.cells=a||emptyGrid()}extend(Game,{begin:function(){var a=new Game();a.initialize();return a}});extend(Game.prototype,{map:function(a){return map(a,this.cells)},fold:function(a,b){return fold(a,b,this.cells)},initialize:function(){this.addRandomTile();this.addRandomTile()},valueAt:function(a,b){return this.cells[indexFor(a,b)]},isOccupied:function(a,b){return this.cells[indexFor(a,b)]!==0},availableCells:function availableCells(){return reduce(function(b,c,a){if(c===0){b.push(a)}return b},[],this.cells)},mergesArePossible:function(){var a=this;return some(function(d,b){if(!d){return}var c=positionFor(b);return a.valueAt(c.x+1,c.y)===d||a.valueAt(c.x-1,c.y)===d||a.valueAt(c.x,c.y+1)===d||a.valueAt(c.x,c.y-1)===d},this.cells)},randomAvailableIndex:function(){var b=this.availableCells(),a=Math.floor(Math.random()*b.length);return b[a]},isGameOver:function isGameOver(){return this.availableCells().length===0&&!this.mergesArePossible()},isGameWon:function isGameWon(){return this.cells.indexOf(2048)!==-1},addRandomTile:function(){if(this.isGameOver()){return}this.cells[this.randomAvailableIndex()]=randomCellValue()},move:function(b){var a=new Game(move(b)(this.cells));if(deepEquals(this.cells,a.cells)){return null}return a}});function GameManager(){this.restart()}extend(GameManager.prototype,{restart:function(){this.history=[];this.game=Game.begin();this.updateUI()},undo:function(){if(this.history.length===0){return}this.game=this.history.pop();this.updateUI()},move:function(b){var a=this.game.move(b);if(a===null){return}this.history.push(this.game);this.game=a;a.addRandomTile();this.updateUI()},updateUI:function(){updateUI(this)},solve:function(){var a=this;if(a.solveTimeout){clearTimeout(a.solveTimeout);a.solveTimeout=null;return}var b=function(){if(a.game.isGameOver()||a.game.isGameWon()){a.solveTimeout=null;return}var d=new Solver(a.game);var c=d.iterativeDeep();a.move(c.move);a.solveTimeout=setTimeout(b,0)};a.solveTimeout=setTimeout(b,0)}});var updateCells=(function(){var b=$(".cell"),a="v2 v4 v8 v16 v32 v64 v128 v256 v512 v1024 v2048",c=function(d){return d?("v"+d):""};return each(function(e,d){$(b[d]).removeClass(a).addClass(c(e))})}()),updateUI=(function(){var c=$(".game-over");var a=$(".game-won");var b=$(".solve");return function(d){updateCells(d.game.cells);d.game.isGameOver()?c.show():c.hide();d.game.isGameWon()?a.show():a.hide();b.text(d.solveTimeout?"STOP":"SOLVE")}}());var manager=new GameManager();$(document).keydown(function(a){switch(a.which){case 37:manager.move(directions.LEFT);break;case 38:manager.move(directions.UP);break;case 39:manager.move(directions.RIGHT);break;case 40:manager.move(directions.DOWN);break;default:return}a.preventDefault()});$(".undo").click(function(){manager.undo()});$(".restart").click(function(){manager.restart()});$(".solve").click(function(){manager.solve()});