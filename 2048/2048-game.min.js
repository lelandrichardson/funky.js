var size=4;var indexFor=function(a,b){if(a>size||b>size||a<1||b<1){return -1}return(b-1)*size+(a-1)};var positionFor=function(a){return{x:(a%size)+1,y:Math.floor(a/size)+1}};var emptyGrid=function(){return[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};var directions={UP:"UP",RIGHT:"RIGHT",DOWN:"DOWN",LEFT:"LEFT"};var traversals={UP:{a:[1,2,3,4],b:[4,3,2,1],vertical:true,dir:"UP"},RIGHT:{a:[1,2,3,4],b:[1,2,3,4],vertical:false,dir:"RIGHT"},DOWN:{a:[1,2,3,4],b:[1,2,3,4],vertical:true,dir:"DOWN"},LEFT:{a:[1,2,3,4],b:[4,3,2,1],vertical:false,dir:"LEFT"}};var cellsToRows=curry(function(d,c){var b=traversals[d],a=b.vertical;return reduce(function(e,f){e.push(reduce(function(h,g){return h.concat(c[indexFor(a?f:g,a?g:f)])},[],b.b));return e},[],b.a)});var rowsToCells=curry(function(a,b){switch(a){case directions.UP:return reverse(flatten(map(function(d,c){return reverse(pluck(c,b))},b)));case directions.DOWN:return flatten(map(function(d,c){return pluck(c,b)},b));case directions.RIGHT:return flatten(b);case directions.LEFT:return flatten(b.map(reverse))}});var transformRow=function(e){var a=[0,0,0,0],c=size,b,d=false;while(c--){b=c;while(e[b]===0){b--}if(b<0){continue}a[c]=e[b];e[b]=0;if(a[c+1]===a[c]&&!d){a[c+1]=2*a[c+1];a[c]=0;c++;d=true}else{d=false}}return a};var move=function(a){return compose(rowsToCells(a),map(transformRow),cellsToRows(a))};var randomCellValue=function(){return Math.random()<0.9?2:4};function Game(a){this.cells=a||emptyGrid()}Game.prototype.map=function(a){return map(a,this.cells)};Game.prototype.fold=function(a,b){return fold(a,b,this.cells)};Game.prototype.initialize=function(){this.addRandomTile();this.addRandomTile()};Game.prototype.valueAt=function(a,b){return this.cells[indexFor(a,b)]};Game.prototype.availableCells=function availableCells(){return this.fold(function(b,c,a){if(c===0){b.push(a)}return b},[])};Game.prototype.mergesArePossible=function(){var a=this;return some(function(d,b){if(!d){return}var c=positionFor(b);return a.valueAt(c.x+1,c.y)===d||a.valueAt(c.x-1,c.y)===d||a.valueAt(c.x,c.y+1)===d||a.valueAt(c.x,c.y-1)===d},this.cells)};Game.prototype.randomAvailableIndex=function(){var b=this.availableCells(),a=Math.floor(Math.random()*b.length);return b[a]};Game.prototype.isGameOver=function(){return this.availableCells().length===0&&!this.mergesArePossible()};Game.prototype.isGameWon=function(){return this.cells.indexOf(2048)!==-1};Game.prototype.addRandomTile=function(){if(this.isGameOver()){return}this.cells[this.randomAvailableIndex()]=randomCellValue()};Game.prototype.move=function(b){var a=new Game(move(b)(this.cells));if(deepEquals(this.cells,a.cells)){return null}return a};function GameManager(a){this.updateUI=a;this.restart()}GameManager.prototype.restart=function(){this.history=[];this.game=new Game();this.game.initialize();this.updateUI()};GameManager.prototype.undo=function(){if(this.history.length===0){return}this.game=this.history.pop();this.updateUI()};GameManager.prototype.move=function(b){var a=this.game.move(b);if(a===null){return}this.history.push(this.game);this.game=a;a.addRandomTile();this.updateUI()};